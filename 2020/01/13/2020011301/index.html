<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ctf-re-脱壳技术学习 | Forgo7ten'blog</title><meta name="description" content="壳的概念学习壳的概念壳是在一些计算机软件里也有一段专门负责保护软件不被非法修改或反编译的程序。壳是在一个程序的外面再包裹上另外一段代码，保护里面的代码不被非法修改或反编译的程序。它们一般都是先于程序运行，拿到控制权，然后完成它们保护软件的任务。 壳的分类壳分为两类：压缩壳和加密壳  压缩壳使用压缩壳可以帮助缩减 PE 文件的大小，隐藏了 PE 文件内部代码和资源，便于网络传输和保存。压缩壳用途：1"><meta name="keywords" content="ctf-re,脱壳技术"><meta name="author" content="Forgo7ten"><meta name="copyright" content="Forgo7ten"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="https://forgo7ten.github.io/2020/01/13/2020011301/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="ctf-re-脱壳技术学习"><meta property="og:url" content="https://forgo7ten.github.io/2020/01/13/2020011301/"><meta property="og:site_name" content="Forgo7ten'blog"><meta property="og:description" content="壳的概念学习壳的概念壳是在一些计算机软件里也有一段专门负责保护软件不被非法修改或反编译的程序。壳是在一个程序的外面再包裹上另外一段代码，保护里面的代码不被非法修改或反编译的程序。它们一般都是先于程序运行，拿到控制权，然后完成它们保护软件的任务。 壳的分类壳分为两类：压缩壳和加密壳  压缩壳使用压缩壳可以帮助缩减 PE 文件的大小，隐藏了 PE 文件内部代码和资源，便于网络传输和保存。压缩壳用途：1"><meta property="og:image" content="https://Forgo7ten.gitee.io/store/img/31.jpg"><meta property="article:published_time" content="2020-01-13T08:19:30.000Z"><meta property="article:modified_time" content="2020-01-13T08:17:00.000Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'true'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"limitCount":50,"languages":{"author":"作者: Forgo7ten","link":"链接: ","source":"来源: Forgo7ten'blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: {"text":"I,LOVE,YOU,ヾ(≧▽≦*)o 点个收藏叭,(*^▽^*),w(ﾟДﾟ)w,ㄟ(≧◇≦)ㄏ,(/≧▽≦)/点个关注叭,Σ(っ °Д °;)っ,(●ˇ∀ˇ●),( •̀ ω •́ )✧,(*/ω＼*),ヽ(*。>Д<)o゜真的不收藏一下嘛,(～o￣3￣)～,ヽ（≧□≦）ノ","fontSize":"15px"},
  medium_zoom: true,
  fancybox: false,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: true    
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-01-13 16:17:00'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 5.0.0"><link rel="alternate" href="/atom.xml" title="Forgo7ten'blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" data-lazy-src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">7</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">7</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A3%B3%E7%9A%84%E6%A6%82%E5%BF%B5%E5%AD%A6%E4%B9%A0"><span class="toc-number">1.</span> <span class="toc-text">壳的概念学习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A3%B3%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">壳的概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A3%B3%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">壳的分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A3%B3%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">壳的加载过程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%84%B1%E5%A3%B3%E4%B8%83%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">脱壳七法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ESP%E5%AE%9A%E5%BE%8B"><span class="toc-number">2.1.</span> <span class="toc-text">ESP定律</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8OD%E8%BD%BD%E5%85%A5"><span class="toc-number">2.1.1.</span> <span class="toc-text">用OD载入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%88F8%E5%8D%95%E6%AD%A5%E8%BF%90%E8%A1%8C%E4%B8%80%E6%AD%A5"><span class="toc-number">2.1.2.</span> <span class="toc-text">先F8单步运行一步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%A1%AC%E4%BB%B6%E6%96%AD%E7%82%B9"><span class="toc-number">2.1.3.</span> <span class="toc-text">设置硬件断点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E6%96%AD%E7%82%B9"><span class="toc-number">2.1.4.</span> <span class="toc-text">触发断点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E6%AD%A5%E8%B7%9F%E8%B8%AA"><span class="toc-number">2.2.</span> <span class="toc-text">单步跟踪</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E9%95%9C%E5%83%8F%E6%B3%95"><span class="toc-number">2.3.</span> <span class="toc-text">内存镜像法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OD%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.3.1.</span> <span class="toc-text">OD设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E9%95%9C%E5%83%8F%E4%B8%8B-rsrc%E6%96%AD%E7%82%B9"><span class="toc-number">2.3.2.</span> <span class="toc-text">内存镜像下.rsrc断点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E9%95%9C%E5%83%8F%E4%B8%8B-text%E6%96%AD%E7%82%B9"><span class="toc-number">2.3.3.</span> <span class="toc-text">内存镜像下.text断点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E6%AD%A5%E8%B7%9F%E8%B8%AA-1"><span class="toc-number">2.3.4.</span> <span class="toc-text">单步跟踪</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E5%90%8E%E4%B8%80%E6%AC%A1%E5%BC%82%E5%B8%B8"><span class="toc-number">2.4.</span> <span class="toc-text">最后一次异常</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OD%E8%AE%BE%E7%BD%AE-1"><span class="toc-number">2.4.1.</span> <span class="toc-text">OD设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B0%E4%B8%8B%E4%BB%8E%E5%BC%80%E5%A7%8B%E6%8C%89SHIFT-F9%E5%88%B0%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E7%9A%84%E6%AC%A1%E6%95%B0m"><span class="toc-number">2.4.2.</span> <span class="toc-text">记下从开始按SHIFT+F9到程序运行的次数m</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E8%BD%BD%EF%BC%8C%E6%91%81m-1%E6%AC%A1shift-F9"><span class="toc-number">2.4.3.</span> <span class="toc-text">重载，摁m-1次shift+F9</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E6%96%AD%E7%82%B9"><span class="toc-number">2.4.4.</span> <span class="toc-text">下断点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E6%AD%A5%E8%B7%9F%E8%B8%AA-2"><span class="toc-number">2.4.5.</span> <span class="toc-text">单步跟踪</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SFX"><span class="toc-number">2.5.</span> <span class="toc-text">SFX</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OD%E8%AE%BE%E7%BD%AE-2"><span class="toc-number">2.5.1.</span> <span class="toc-text">OD设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E8%87%B3SFX%E9%80%89%E9%A1%B9%E5%8D%A1"><span class="toc-number">2.5.2.</span> <span class="toc-text">切换至SFX选项卡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E8%BD%BD%E7%A8%8B%E5%BA%8F"><span class="toc-number">2.5.3.</span> <span class="toc-text">重载程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A5%E5%88%B0OEP"><span class="toc-number">2.5.4.</span> <span class="toc-text">来到OEP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%8C%E6%AF%95%E5%B0%86OD%E8%AE%BE%E7%BD%AE%E8%BF%98%E5%8E%9F"><span class="toc-number">2.5.5.</span> <span class="toc-text">使用完毕将OD设置还原</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BA%E5%8F%A3%E6%A0%87%E5%BF%97"><span class="toc-number">2.6.</span> <span class="toc-text">出口标志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BB%E6%89%BE%E5%8E%8B%E6%A0%88%E5%91%BD%E4%BB%A4"><span class="toc-number">2.6.1.</span> <span class="toc-text">寻找压栈命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BEpopad%E5%91%BD%E4%BB%A4"><span class="toc-number">2.6.2.</span> <span class="toc-text">查找popad命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F%E8%B7%9F%E8%B8%AA"><span class="toc-number">2.7.</span> <span class="toc-text">模拟跟踪</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%86%85%E5%AD%98%E9%95%9C%E5%83%8F%E6%B3%95"><span class="toc-number">2.7.1.</span> <span class="toc-text">使用内存镜像法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E5%86%85%E5%AD%98%E9%95%9C%E5%83%8F%E4%B8%AD%E5%AF%BB%E6%89%BE-nPack%E6%AE%B5"><span class="toc-number">2.7.2.</span> <span class="toc-text">在内存镜像中寻找.nPack段</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%84%B1%E5%A3%B3%E5%AE%9E%E6%88%98%E2%80%94%E8%84%B1%E5%A3%B3%E5%8F%8A%E4%BF%AE%E5%A4%8DIAT"><span class="toc-number">3.</span> <span class="toc-text">脱壳实战—脱壳及修复IAT</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7%EF%BC%9A"><span class="toc-number">3.1.</span> <span class="toc-text">使用工具：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E9%A2%98%EF%BC%9AIT%E4%BF%AE%E5%A4%8D"><span class="toc-number">3.2.</span> <span class="toc-text">第一题：IT修复</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E5%A3%B3"><span class="toc-number">3.2.1.</span> <span class="toc-text">查壳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BB%E6%89%BEOEP"><span class="toc-number">3.2.2.</span> <span class="toc-text">寻找OEP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8lordPE%E8%BF%9B%E8%A1%8Cdump"><span class="toc-number">3.2.3.</span> <span class="toc-text">使用lordPE进行dump</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Import-REC%E8%BF%9B%E8%A1%8CIAT%E4%BF%AE%E5%A4%8D"><span class="toc-number">3.2.4.</span> <span class="toc-text">使用Import REC进行IAT修复</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#importREC%E6%9C%89%E5%87%A0%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-number">3.2.4.1.</span> <span class="toc-text">importREC有几个参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%9F%A5%E6%89%BEIAT%E5%B9%B6%E4%BF%AE%E5%A4%8D"><span class="toc-number">3.2.5.</span> <span class="toc-text">手动查找IAT并修复</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%A6%E4%B8%80%E7%A7%8D%E5%AF%BB%E6%89%BE%E5%87%BD%E6%95%B0%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-number">3.2.5.1.</span> <span class="toc-text">另一种寻找函数的方法：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%A2%98%EF%BC%9A%E8%84%B1%E5%A3%B3%E7%BB%83%E4%B9%A02"><span class="toc-number">3.3.</span> <span class="toc-text">第二题：脱壳练习2</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%84%E8%AF%AD%E8%A8%80OEP%E6%88%AA%E5%9B%BE"><span class="toc-number">4.</span> <span class="toc-text">各语言OEP截图</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://Forgo7ten.gitee.io/store/img/31.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">Forgo7ten'blog</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">ctf-re-脱壳技术学习</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-01-13T08:19:30.000Z" title="发表于 2020-01-13 16:19:30">2020-01-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-01-13T08:17:00.000Z" title="更新于 2020-01-13 16:17:00">2020-01-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ctf-re/">ctf-re</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ctf-re/re%E5%AD%A6%E4%B9%A0/">re学习</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>9分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="壳的概念学习"><a href="#壳的概念学习" class="headerlink" title="壳的概念学习"></a>壳的概念学习</h1><h2 id="壳的概念"><a href="#壳的概念" class="headerlink" title="壳的概念"></a>壳的概念</h2><p>壳是在一些计算机软件里也有一段专门负责保护软件不被非法修改或反编译的程序。<br>壳是在一个程序的外面再包裹上另外一段代码，保护里面的代码不被非法修改或反编译的程序。它们一般都是先于程序运行，拿到控制权，然后完成它们保护软件的任务。</p>
<h2 id="壳的分类"><a href="#壳的分类" class="headerlink" title="壳的分类"></a>壳的分类</h2><p>壳分为两类：<strong>压缩壳</strong>和<strong>加密壳</strong></p>
<ol>
<li>压缩壳<br>使用压缩壳可以帮助缩减 PE 文件的大小，隐藏了 PE 文件内部代码和资源，便于网络传输和保存。<br>压缩壳用途：<pre><code>1. 单纯用于压缩普通 PE 文件的压缩壳
2. 对源文件进行较大变形，严重破坏 PE 文件头，经常用于压缩恶意程序。</code></pre>
常见的压缩壳<pre><code>- UPX
- ASpack
- PECompat</code></pre>
<ol start="2">
<li>加密壳<br>功能：保护 PE 免受代码逆向分析<br>用途：<ol>
<li>对安全性要求高，对破解敏感的应用程序</li>
<li>恶意程序用于避免（降低）杀毒软件的检测查杀<br>常见的加密壳：</li>
</ol>
<ul>
<li>ASProtector</li>
<li>Armadillo</li>
<li>EXECryptor</li>
<li>Themida</li>
<li>VMProtect<h2 id="壳的加载过程"><a href="#壳的加载过程" class="headerlink" title="壳的加载过程"></a>壳的加载过程</h2></li>
</ul>
</li>
<li>保存入口参数<ol>
<li>加壳程序初始化时保存各寄存器的值</li>
<li>外壳执行完毕，恢复各寄存器值</li>
<li>最后再跳到原程序执行<br>通常使用```pushad / popad、pushfd / popfd````指令对寄存器进行保存和恢复</li>
</ol>
</li>
<li>获取所需函数API<ol>
<li>一般壳的输入表中只有 GetProcAddress、GetModuleHandle 和 LoadLibrary 这几个 API 函数</li>
<li>如果需要其他 API 函数，则通过 LoadLibraryA(W) 或 LoadLibraryExA(W) 将 DLL 文件映射到调用进程的地址空间中</li>
<li>如果 DLL 文件已被映射到调用进程的地址空间里，就可以调用 GetModuleHandleA(W) 函数获得 DLL 模块句柄</li>
<li>一旦 DLL 模块被加载，就可以调用 GetProcAddress 函数获取输入函数的地址</li>
</ol>
</li>
<li>跳转回原程序入口点（OEP）<ol>
<li>在跳转回入口点之前，恢复填写原PE文件输入表（IAT），并处理好重定位项（主要是 DLL 文件）</li>
<li>对每一个 DLL 引入的所有函数重新获取地址，并填写到 IAT 表中（因为加壳时外壳自己构造了一个输入表）</li>
<li>将控制权移交原程序，并继续执行</li>
</ol>
</li>
</ol>
</li>
</ol>
<h1 id="脱壳七法"><a href="#脱壳七法" class="headerlink" title="脱壳七法"></a>脱壳七法</h1><h2 id="ESP定律"><a href="#ESP定律" class="headerlink" title="ESP定律"></a>ESP定律</h2><p>使用条件：OD载入之后F8单步一下，寄存器ESP中存放的值被改变（开始第一条语句为<code>pushad</code>）</p>
<h3 id="用OD载入"><a href="#用OD载入" class="headerlink" title="用OD载入"></a>用OD载入</h3><p><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220204749365.png" alt="在这里插入图片描述"></p>
<h3 id="先F8单步运行一步"><a href="#先F8单步运行一步" class="headerlink" title="先F8单步运行一步"></a>先F8单步运行一步</h3><p><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220204813500.png" alt="在这里插入图片描述"><br>发现ESP寄存器被改变，可以使用ESP定律<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220205147946.png" alt="在这里插入图片描述"></p>
<h3 id="设置硬件断点"><a href="#设置硬件断点" class="headerlink" title="设置硬件断点"></a>设置硬件断点</h3><p>右键数据窗口跟随，||     <em>或者直接点HW break[ESP]，此插件会自动帮忙下好硬件断点</em><br>数据窗口设置<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220205831464.png" alt="在这里插入图片描述"><br>从最开始的数据开始选，（别选太少就行）然后右键→断点→硬件访问→这里的三个随便选一个都可以，我一般选word<br>此时菜单栏→调试→硬件断点  已经有了我们下的断点<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220210102458.png" alt="在这里插入图片描述"></p>
<h3 id="触发断点"><a href="#触发断点" class="headerlink" title="触发断点"></a>触发断点</h3><p>然后F9运行程序，来到这里，此时可以删除硬件断点了<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220210123564.png" alt="在这里插入图片描述"><br>然后F8单步往下<img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220210918594.png" alt="在这里插入图片描述"><br>如果遇到向上图这样的，向上的代码，则在下一行代码（上图中的为地址0x004052E8）右键→断点→运行到选定位置（<em>快捷键F4</em>）<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220211100121.png" alt="在这里插入图片描述"><br>删除图中的灰色代码（db 00）可以选择右键→分析→从模块中删除分析<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/2019122021130275.png" alt="在这里插入图片描述"><br>分析完的模样<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220211350253.png" alt="在这里插入图片描述"><br>然后继续F8，此时出现了一个jmp大跳转（说明离OEP很近了）我们继续F8向下。<br>此时我们来到了OEP<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220211518419.png" alt="在这里插入图片描述"></p>
<h2 id="单步跟踪"><a href="#单步跟踪" class="headerlink" title="单步跟踪"></a>单步跟踪</h2><ol>
<li>打开程序按F8单步向下, 尽量实现向下的jmp跳转</li>
<li>会经常遇到大的循环, 这时要多用 F4 来跳过循环</li>
<li>如果函数载入时不远处就是一个call(近call), 那么我们尽量不要直接跳过, 而是进入这个call</li>
<li>一般跳转幅度大的jmp指令, 都极有可能是跳转到了原程序入口点(OEP)</li>
</ol>
<p>如果执行到某一个call程序运行起来了，在call下断点，重新载入F7步入call继续单步</p>
<h2 id="内存镜像法"><a href="#内存镜像法" class="headerlink" title="内存镜像法"></a>内存镜像法</h2><p>大致步骤</p>
<ol>
<li>选择菜单的选项-&gt;调试选项-&gt;异常，勾选所有的忽略异常</li>
<li>按下ALT+M, 打开内存镜像, 找到程序的第一个.rsrc, 按F2下断点, 然后按SHIFT+F9运行到断点</li>
<li>再按ALT+M, 打开内存镜像, 找到程序的第一个.rsrc上面的.text(在示例中是00401000处), 按F2下断点. 然后按SHIFT+F9（或者是在没异常情况下按F9）<h3 id="OD设置"><a href="#OD设置" class="headerlink" title="OD设置"></a>OD设置</h3></li>
<li>OD菜单栏→选项→调试设置<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221150135936.png" alt="在这里插入图片描述"></li>
<li>打开【异常】标签，将所有的框都勾选上，也就是<strong>忽略所有异常</strong><br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221150226872.png" alt="在这里插入图片描述"><h3 id="内存镜像下-rsrc断点"><a href="#内存镜像下-rsrc断点" class="headerlink" title="内存镜像下.rsrc断点"></a>内存镜像下.rsrc断点</h3></li>
<li>打开内存镜像窗口（快捷键Alt+M）或点击下图按钮<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221153439406.png" alt="在这里插入图片描述"></li>
<li>找到当前被调试程序的rsrc段<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221153508666.png" alt="在这里插入图片描述"></li>
<li>F2下断点<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221153533255.png" alt="在这里插入图片描述"></li>
<li>F9运行<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/2019122115360871.png" alt="在这里插入图片描述"><h3 id="内存镜像下-text断点"><a href="#内存镜像下-text断点" class="headerlink" title="内存镜像下.text断点"></a>内存镜像下.text断点</h3></li>
<li>下断点<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221153630554.png" alt="在这里插入图片描述"></li>
<li>运行<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/2019122115391254.png" alt="**加粗样式**"><h3 id="单步跟踪-1"><a href="#单步跟踪-1" class="headerlink" title="单步跟踪"></a>单步跟踪</h3>单步到这里的时候有两个向上的jmp跳转，选择jmp的下一行代码，然后F4运行到选定位置<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221154205875.png" alt="在这里插入图片描述"><br>继续单步<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221154309437.png" alt="在这里插入图片描述"><br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221154324819.png"><br>来到OEP<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221154349410.png" alt="在这里插入图片描述"></li>
</ol>
<h2 id="最后一次异常"><a href="#最后一次异常" class="headerlink" title="最后一次异常"></a>最后一次异常</h2><ol>
<li>点击选项-&gt;调试选项—&gt;异常, 把里面的√全部去掉! 按下CTRL+F2重载下程序</li>
<li>按SHIFT+F9, 直到程序运行, 记下从开始按SHIFT+F9到程序运行的次数m</li>
<li>CTRL+F2重载程序, 按SHIFT+F9(这次按的次数为程序运行的次数m-1次</li>
<li>在OD的右下角我们看见有一个”SE 句柄”, 这时我们按CTRL+G, 输入SE 句柄前的地址</li>
<li>按F2下断点，然后按SHIFT+F9来到断点处, F8单步跟踪<h3 id="OD设置-1"><a href="#OD设置-1" class="headerlink" title="OD设置"></a>OD设置</h3></li>
<li>OD菜单栏→选项→调试设置<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221150135936.png" alt="在这里插入图片描述"></li>
<li>不忽略所有异常，取消全部的勾<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221154854169.png" alt="在这里插入图片描述"><br>重载程序<h3 id="记下从开始按SHIFT-F9到程序运行的次数m"><a href="#记下从开始按SHIFT-F9到程序运行的次数m" class="headerlink" title="记下从开始按SHIFT+F9到程序运行的次数m"></a>记下从开始按SHIFT+F9到程序运行的次数m</h3>第一次<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221155210695.png" alt="在这里插入图片描述"><br>第二次打开，摁了两次，则m=2<h3 id="重载，摁m-1次shift-F9"><a href="#重载，摁m-1次shift-F9" class="headerlink" title="重载，摁m-1次shift+F9"></a>重载，摁m-1次shift+F9</h3><h3 id="下断点"><a href="#下断点" class="headerlink" title="下断点"></a>下断点</h3><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221155417861.png" alt="在这里插入图片描述"></li>
<li>在【SE处理程序】或【SE句柄】右键→反汇编窗口跟随<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/2019122115553368.png" alt="在这里插入图片描述"></li>
<li>F2下断点</li>
<li>shift+F9运行<h3 id="单步跟踪-2"><a href="#单步跟踪-2" class="headerlink" title="单步跟踪"></a>单步跟踪</h3>单步跟踪来到OEP<h2 id="SFX"><a href="#SFX" class="headerlink" title="SFX"></a>SFX</h2></li>
<li>设置OD, 忽略所有异常, 也就是说异常选项卡里面都打上勾</li>
<li>切换到SFX选项卡, 选择”字节模式跟踪实际入口(速度非常慢)”, 确定</li>
<li>重载程序(如果跳出是否”压缩代码?”选择”否”, OD直接到达OEP)<h3 id="OD设置-2"><a href="#OD设置-2" class="headerlink" title="OD设置"></a>OD设置</h3><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221150226872.png" alt="在这里插入图片描述"><h3 id="切换至SFX选项卡"><a href="#切换至SFX选项卡" class="headerlink" title="切换至SFX选项卡"></a>切换至SFX选项卡</h3>选择 字节方式跟踪真正入口出(速度非常慢)<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221160000603.png" alt="在这里插入图片描述"><br>点击【确定】<h3 id="重载程序"><a href="#重载程序" class="headerlink" title="重载程序"></a>重载程序</h3>重载后会自动跟踪<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221160237487.png" alt="在这里插入图片描述"><br>只需等待即可<h3 id="来到OEP"><a href="#来到OEP" class="headerlink" title="来到OEP"></a>来到OEP</h3>等待其跟踪完之后，来到OEP<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221160356139.png" alt="在这里插入图片描述"><h3 id="使用完毕将OD设置还原"><a href="#使用完毕将OD设置还原" class="headerlink" title="使用完毕将OD设置还原"></a>使用完毕将OD设置还原</h3></li>
</ol>
<h2 id="出口标志"><a href="#出口标志" class="headerlink" title="出口标志"></a>出口标志</h2><h3 id="寻找压栈命令"><a href="#寻找压栈命令" class="headerlink" title="寻找压栈命令"></a>寻找压栈命令</h3><p>这里最开始的压栈命令为<code>pushad</code>，则对应的出栈命令则为<code>popad</code><br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/2019122116152236.png" alt="在这里插入图片描述"></p>
<h3 id="查找popad命令"><a href="#查找popad命令" class="headerlink" title="查找popad命令"></a>查找<code>popad</code>命令</h3><ol>
<li><p>右键→查找→命令（或者使用快捷键ctrl+F）<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221161729258.png" alt="在这里插入图片描述"></p>
</li>
<li><p>输入<code>popad</code>，并取消【整个块】前面的框勾选<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221161902733.png" alt="在这里插入图片描述"></p>
</li>
<li><p>点击【查找】</p>
</li>
<li><p>先在<code>popad</code>那条命令，F4，执行到选定位置。<br>如果程序运行，则寻找下一个popad，（快捷键ctrl+l）直到F4后程序不运行，则找到对应pushad的那个popad</p>
</li>
</ol>
<p>第一次<img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221162717844.png" alt="在这里插入图片描述"><br>第二次<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221162743256.png"><br>第三次<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221162815349.png" alt="在这里插入图片描述"><br>第四次<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221162849443.png" alt="在这里插入图片描述"><br>疑似，找到OEP，F4运行到此处的<code>popad</code>，发现程序没有运行<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221162933149.png" alt="在这里插入图片描述"><br>然后F8单步跟踪找到OEP<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221163013890.png" alt="在这里插入图片描述"><br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221163034411.png" alt="在这里插入图片描述"></p>
<h2 id="模拟跟踪"><a href="#模拟跟踪" class="headerlink" title="模拟跟踪"></a>模拟跟踪</h2><h3 id="使用内存镜像法"><a href="#使用内存镜像法" class="headerlink" title="使用内存镜像法"></a>使用内存镜像法</h3><h3 id="在内存镜像中寻找-nPack段"><a href="#在内存镜像中寻找-nPack段" class="headerlink" title="在内存镜像中寻找.nPack段"></a>在内存镜像中寻找.nPack段</h3><p>在命令框中输入<code>tc eip &lt; xxx</code>其中xxx为.nPack段的地址<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221161148945.png" alt="在这里插入图片描述"><br>然后OD会自动跟踪，等结果就好</p>
<h1 id="脱壳实战—脱壳及修复IAT"><a href="#脱壳实战—脱壳及修复IAT" class="headerlink" title="脱壳实战—脱壳及修复IAT"></a>脱壳实战—脱壳及修复IAT</h1><p>题目：<br>链接: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1wQIwaCu99mYHX8gyqMfMMQ">https://pan.baidu.com/s/1wQIwaCu99mYHX8gyqMfMMQ</a> 提取码: qwcm</p>
<p>脱壳最好在windows XP环境中</p>
<h2 id="使用工具："><a href="#使用工具：" class="headerlink" title="使用工具："></a>使用工具：</h2><ol>
<li>OD</li>
<li>lordPE</li>
<li>ImportREC</li>
</ol>
<h2 id="第一题：IT修复"><a href="#第一题：IT修复" class="headerlink" title="第一题：IT修复"></a>第一题：IT修复</h2><h3 id="查壳"><a href="#查壳" class="headerlink" title="查壳"></a>查壳</h3><p><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220204403882.png" alt="在这里插入图片描述"><br>UPX的壳，无难度</p>
<h3 id="寻找OEP"><a href="#寻找OEP" class="headerlink" title="寻找OEP"></a>寻找OEP</h3><p>用OD载入<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220204749365.png" alt="在这里插入图片描述"><br>先F8单步运行一步<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220204813500.png" alt="在这里插入图片描述"><br>发现ESP寄存器被改变，可以使用ESP定律<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220205147946.png" alt="在这里插入图片描述"><br>右键数据窗口跟随，||     <em>或者直接点HW break[ESP]，此插件会自动帮忙下好硬件断点</em><br>数据窗口设置<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220205831464.png" alt="在这里插入图片描述"><br>从最开始的数据开始选，（别选太少就行）然后右键→断点→硬件访问→这里的三个随便选一个都可以，我一般选word<br>此时菜单栏→调试→硬件断点  已经有了我们下的断点<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220210102458.png" alt="在这里插入图片描述"><br>然后F9运行程序，来到这里，此时可以删除硬件断点了<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220210123564.png" alt="在这里插入图片描述"><br>然后F8单步往下<img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220210918594.png" alt="在这里插入图片描述"><br>如果遇到向上图这样的，向上的代码，则在下一行代码（上图中的为地址0x004052E8）右键→断点→运行到选定位置（<em>快捷键F4</em>）<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220211100121.png" alt="在这里插入图片描述"><br>删除图中的灰色代码（db 00）可以选择右键→分析→从模块中删除分析<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/2019122021130275.png" alt="在这里插入图片描述"><br>分析完的模样<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220211350253.png" alt="在这里插入图片描述"><br>然后继续F8，此时出现了一个jmp大跳转（说明离OEP很近了）我们继续F8向下。<br>此时我们来到了OEP<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220211518419.png" alt="在这里插入图片描述"><br>脱壳的话，可以右键→用OllyDump脱壳调试进程，点脱壳就好<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220211640877.png" alt="在这里插入图片描述"><br>而此时我们练习手动修复IAT</p>
<h3 id="使用lordPE进行dump"><a href="#使用lordPE进行dump" class="headerlink" title="使用lordPE进行dump"></a>使用lordPE进行dump</h3><p>不要关闭OD，打开lordPE<br>然后将进程的浮块滑到最底部（lordPE的进程，最新的进程在最底部）<br>然后点击要附加的程序<br>右键→修正镜像大小<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220212117610.png" alt="在这里插入图片描述"><br>然后继续右键→完整转存</p>
<h3 id="使用Import-REC进行IAT修复"><a href="#使用Import-REC进行IAT修复" class="headerlink" title="使用Import REC进行IAT修复"></a>使用Import REC进行IAT修复</h3><p>OD还是不能关<br>先打开ImportREC附加没有脱壳的已经到达OEP的进程（新的进程在最上面）<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220212240354.png" alt="在这里插入图片描述"><br>我们要记住OD脱壳插件中显示的OEP地址<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220212434829.png" alt="在这里插入图片描述"><br>或者记住OEP前面的地址也行<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220212522445.png" alt="在这里插入图片描述"></p>
<h4 id="importREC有几个参数"><a href="#importREC有几个参数" class="headerlink" title="importREC有几个参数"></a>importREC有几个参数</h4><ol>
<li>OEP栏：这里填写OEP的相对偏移地址就行，上面401000-400000=1000（也就是OD脱壳插件显示的那个OEP）</li>
<li>RVA：虚拟内存地址，这里填IAT的起始位置</li>
<li>大小：填写导入表大小，需要用IAT的末地址减去首地址。（大小可以写大，但绝不能写小）<br>相对地址则为实际地址减去基址（基址在OD中e窗口中查看）</li>
</ol>
<p>如果自动搜索IAT的话，用如下步骤<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220212957515.png" alt="在这里插入图片描述"><br>获取导入表之后，<strong>点按钮【显示无效的】，如果有导入表函数，右键删除即可</strong><br>无效函数删除之后，再点【修正转储】<br>点击后会弹出一个窗口选择一个PE文件，我们选择<strong>之前lordPEdump出来的文件</strong><br>然后脱壳完成。</p>
<h3 id="手动查找IAT并修复"><a href="#手动查找IAT并修复" class="headerlink" title="手动查找IAT并修复"></a>手动查找IAT并修复</h3><ol>
<li>在OD中 右键→查找→所有模块间的调用<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220213538708.png" alt="在这里插入图片描述"><br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220213604261.png" alt="在这里插入图片描述"><br>然后双击一个<strong>程序本身的函数</strong>不要选<strong>系统函数</strong><br>来到函数调用处<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220213726603.png" alt="在这里插入图片描述"><br>右键→跟随，进入函数（快捷键：回车）<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220213758528.png" alt="在这里插入图片描述"><br>来到这里<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220213913877.png" alt="在这里插入图片描述"><br>然后再右键→数据窗口中跟随→内存地址<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220214009735.png" alt="在这里插入图片描述"><br>为了便于查看， 可以更改一下数据窗口的显示方式<br>右键→长型→地址<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220214101688.png" alt="在这里插入图片描述"><br>或者在下面的窗口里输入<code>d xxx</code>，其中xxx为jmp后的地址<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220214319919.png" alt="在这里插入图片描述"></li>
</ol>
<p><strong>IAT段是连续的，向上找到开头，向下找到结尾</strong></p>
<p>可以知道<br>起始：0x00402000<br>结束：0x0040200C<br>RVA：0x00402000 - 0x00400000 = 0x00002000（相对偏移地址）<br>大小：0x0040200C - 0x00402000 = 0xC</p>
<p>填入<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/2019122021515181.png" alt="在这里插入图片描述"><br>然后获取导入表，删除无效函数（此程序没有无效函数），【修正转储】，选择之前用lordPE软件dump出的文件，确定。</p>
<p>可以正常打开，成功。<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/2019122021532947.png" alt="在这里插入图片描述"></p>
<h4 id="另一种寻找函数的方法："><a href="#另一种寻找函数的方法：" class="headerlink" title="另一种寻找函数的方法："></a>另一种寻找函数的方法：</h4><p>用ImportREC进行IAT自动搜索，获取导入表，在导入表中找到一个函数，记录此函数的相对偏移<img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220215544781.png" alt="在这里插入图片描述"><br>然后0x00002004 + 0x0040000 = 0x00402004得到此函数的地址，然后在od底部的命令框中输入<code>d xxx</code>，其中xxx为jmp后的地址，来达到找到IAT段的目的<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191220215658414.png" alt="在这里插入图片描述"></p>
<h2 id="第二题：脱壳练习2"><a href="#第二题：脱壳练习2" class="headerlink" title="第二题：脱壳练习2"></a>第二题：脱壳练习2</h2><p>步骤同第一题</p>
<h1 id="各语言OEP截图"><a href="#各语言OEP截图" class="headerlink" title="各语言OEP截图"></a>各语言OEP截图</h1><p>﻿1. 易语言独立编译<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221124347432.png" alt="在这里插入图片描述"><br>2. 易语言非独立编译<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221124359411.png" alt="在这里插入图片描述"><br>3. VC++6<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221123717559.png" alt="在这里插入图片描述"><br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221124445918.png" alt="在这里插入图片描述"><br>4. VC++7<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221124440479.png" alt="在这里插入图片描述"><br>5. VB5<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/2019122112382578.png" alt="在这里插入图片描述"><br>6. VB6<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221123837530.png" alt="在这里插入图片描述"><br>7. Delphi<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221124141795.png" alt="在这里插入图片描述"><br>8. BC++<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221123905888.png" alt="在这里插入图片描述"><br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221124208801.png" alt="在这里插入图片描述"><br>9. VS2008Debug<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221123515732.png" alt="在这里插入图片描述"><br>10. VS2008Release<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221123608732.png" alt="在这里插入图片描述"><br>11. VS2012-VS2015 Debug<img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221124035894.png" alt="在这里插入图片描述"><br>12. VS2012-VS2015 Release<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221124056750.png" alt="在这里插入图片描述"><br>13. 汇编语言<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20191221124527513.png" alt="在这里插入图片描述"> </p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Forgo7ten</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://forgo7ten.github.io/2020/01/13/2020011301/">https://forgo7ten.github.io/2020/01/13/2020011301/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://Forgo7ten.github.io" target="_blank">Forgo7ten'blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ctf-re/">ctf-re</a><a class="post-meta__tags" href="/tags/%E8%84%B1%E5%A3%B3%E6%8A%80%E6%9C%AF/">脱壳技术</a></div><div class="post_share"><div class="social-share" data-image="https://Forgo7ten.gitee.io/store/img/31.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2020/01/15/2020011501/"><img class="prev-cover" data-lazy-src="https://Forgo7ten.gitee.io/store/img/32.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Base16,Base32,Base64编码详细学习</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/01/15/2020011501/" title="Base16,Base32,Base64编码详细学习"><img class="relatedPosts_cover" data-lazy-src="https://Forgo7ten.gitee.io/store/img/32.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-01-15</div><div class="relatedPosts_title">Base16,Base32,Base64编码详细学习</div></div></a></div><div class="relatedPosts_item"><a href="/2020/01/28/2020012801/" title="python-bytecode|python字节码学习"><img class="relatedPosts_cover" data-lazy-src="https://Forgo7ten.gitee.io/store/img/32.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-01-28</div><div class="relatedPosts_title">python-bytecode|python字节码学习</div></div></a></div><div class="relatedPosts_item"><a href="/2020/01/16/2020011601/" title="Z3安装_语句详解"><img class="relatedPosts_cover" data-lazy-src="https://Forgo7ten.gitee.io/store/img/8.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-01-16</div><div class="relatedPosts_title">Z3安装_语句详解</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/06/2020020601/" title="reverse加密算法：RSA|SM4|RC4|MD5|AES|Tea"><img class="relatedPosts_cover" data-lazy-src="https://Forgo7ten.gitee.io/store/img/7.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-02-06</div><div class="relatedPosts_title">reverse加密算法：RSA|SM4|RC4|MD5|AES|Tea</div></div></a></div></div></div></article></main><footer id="footer" style="background-image: url(https://Forgo7ten.gitee.io/store/img/31.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By Forgo7ten</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://Forgo7ten.github.io/">blog</a>!</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/third-party/ClickShowText.js" async="async"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"superSample":2,"width":200,"height":400,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false});</script></body></html>